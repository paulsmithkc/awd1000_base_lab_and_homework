"use strict";var deck=function(){var a=function(){var a=[],b=["c","d","h","s"];for(var c in b)for(var d=1;d<=13;d++)a.push(d+"-"+b[c]);return a};return{cards:a(),needsShuffling:function(){return this.cards.length<10},shuffle:function(){this.cards=a(),alert("Shuffling...")},deal:function(){var a=Math.floor(Math.random()*this.cards.length),b=this.cards[a];return this.cards.splice(a,1),b}}}(),Hand=function(){this.cards=[],this.total=0};Hand.prototype.hasAce=function(){return this.cards.some(function(a){return"1"===a.split("-")[0]})},Hand.prototype.add=function(a){this.cards.push(a);var b=this.cards.reduce(function(a,b){var c=parseInt(b.split("-")[0]);return c>10?a+10:a+c},0);b<=11&&this.hasAce()&&(b+=10),this.total=b},Hand.prototype.hasBlackJack=function(){if(2===this.cards.length&&21===this.total)return!0},Hand.prototype.busted=function(){return this.total>21},Hand.prototype.mustHit=function(){return this.total<17||!(17!==this.total||2!==this.cards.total||!this.hasAce())};var game={dealer:new Hand,player:new Hand,balance:0,deal:function(){deck.needsShuffling()&&deck.shuffle(),this.dealer=new Hand,this.player=new Hand,this.player.add(deck.deal()),this.dealer.add(deck.deal()),this.player.add(deck.deal()),this.dealer.add(deck.deal())},hit:function(a){"dealer"===a.toLowerCase()?this.dealer.add(deck.deal()):this.player.add(deck.deal())},playerWins:function(){return!!(this.dealer.busted()||!this.player.busted()&&this.dealer.total<this.player.total)},dealerWins:function(){return!!(this.player.busted()||!this.dealer.busted()&&this.player.total<this.dealer.total)},updateBalance:function(a){this.player.hasBlackJack()&&(a+=.5*a),this.balance=this.balance+a}};!function(a){a.fn.blackjack=function(b){var c=a.extend({dealerName:"Dealer",playerName:"Player",bet:5},b);for(var d in deck.cards){var e=new Image;e.src="cards/"+deck.cards[d]+".png"}return this.each(function(){a(this).addClass("blackjack");var b="<label>"+c.dealerName+":</label>";b+="<span>&nbsp;</span>",b+="<div id='dealer'>&nbsp;</div>",b=b+"<label>"+c.playerName+":</label>",b+="<span>&nbsp;</span>",b+="<div id='player'>&nbsp;</div>",b+="<input type='button' id='deal' value='Deal'>",b+="<input type='button' id='hit' value='Hit'>",b+="<input type='button' id='stand' value='Stand'><br>",b=b+"<span>Bet: "+c.bet+"</span>",b+="<label id='balance' class='balance'>Balance: 0</label>",b+="<label id='outcome' class='outcome'>&nbsp;</label>",a(this).html(b);var d=function(){a("#dealer").html(""),a("#dealer").prev().text(""),a("#player").html(""),a("#player").prev().text(""),a("#outcome").text(""),a("#hit").prop("disabled",!1),a("#stand").prop("disabled",!1)},e=function(a,b){var c=0,d="";for(b===!1&&(c=1,d="<img src='cards/back.png'>"),c;c<a.length;c++)d=d+"<img src='cards/"+a[c]+".png'>";return d+="<p class='clear'></p>"},f=function(){a("#dealer").html(e(game.dealer.cards)),a("#dealer").prev().text(game.dealer.total),a("#player").html(e(game.player.cards)),a("#player").prev().text(game.player.total),a("#hit").prop("disabled",!0),a("#stand").prop("disabled",!0),game.playerWins()?(a("#outcome").text("You Win!"),game.updateBalance(c.bet)):game.dealerWins()?(a("#outcome").text("You Lose :("),game.updateBalance(-c.bet)):a("#outcome").text("PUSH"),a("#balance").text("Balance: "+game.balance)};a("#deal").click(function(){d(),game.deal(),game.dealer.hasBlackJack()||game.player.hasBlackJack()?f():(a("#dealer").html(e(game.dealer.cards,!1)),a("#player").html(e(game.player.cards)),a("#player").prev().text(game.player.total))}),a("#hit").click(function(){game.hit("player"),game.player.busted()?f():(a("#player").html(e(game.player.cards)),a("#player").prev().text(game.player.total))}),a("#stand").click(function(){a("#hit").prop("disabled",!0),a("#stand").prop("disabled",!0),a("#dealer").html(e(game.dealer.cards)),a("#dealer").prev().text(game.dealer.total);var b=setInterval(function(){game.dealer.mustHit()?(game.hit("dealer"),a("#dealer").html(e(game.dealer.cards)),a("#dealer").prev().text(game.dealer.total)):(clearInterval(b),f())},1e3)}),a("#deal").focus()})}}(jQuery);